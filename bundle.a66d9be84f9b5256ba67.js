(()=>{"use strict";function t(t,e){const n=new URL(t);return n.search=new URLSearchParams(e).toString(),n.toString()}const e="41c67233bcd94457a9d0cecaf0e36aae";function n(t){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="";for(let o=0;o<t;o++)n+=e.charAt(Math.floor(Math.random()*e.length));return n}function o(){const o=localStorage.getItem("access_token");if(o)return Promise.resolve(o);const a=function(){const t=new URLSearchParams(window.location.search),e=Object.fromEntries(t.entries());if(e.state==localStorage.getItem("authorization_state"))return e.code}();return a?(history.replaceState({},document.title,location.pathname),async function(t){const n=localStorage.getItem("code_verifier");return n?(await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:e,grant_type:"authorization_code",code:t,redirect_uri:"https://barkm.github.io/spotify-bpm/",code_verifier:n})})).json().then((t=>t.access_token)):null}(a).then((t=>t?(localStorage.setItem("access_token",t),t):null))):(function(){const o=n(64);localStorage.setItem("authorization_state",o);const a=n(64);localStorage.setItem("code_verifier",a),async function(t){const e=await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(t));return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(a).then((n=>{localStorage.setItem("code_challenge",n);const a=t("https://accounts.spotify.com/authorize",{client_id:e,scope:"user-read-currently-playing",show_dialog:"true",redirect_uri:"https://barkm.github.io/spotify-bpm/",state:o,response_type:"code",code_challenge_method:"S256",code_challenge:n});window.open(a,"_self")}))}(),null)}async function a(e,n,o,a={}){const i=t("https://api.spotify.com/v1/"+e,a),r=await fetch(i,{method:n,headers:{Authorization:"Bearer "+o,"Content-Type":"application/json",Accept:"application/json"}});if(401==r.status)throw Error("401");return 204==r.status?null:r.json()}function i(t){document.getElementById("container").innerHTML=t?`\n      <div id="tempo">\n        <span id="tempo-value">${Math.round(t.tempo)}</span>\n        <span id="tempo-unit">BPM</span>\n      </div>\n      <div id="song">${t.name}</div>\n      <div id="artists">${t.artists.join(", ")}</div>\n    `:'<div id="song">No track is playing</div>'}o()?.then((t=>{t&&function(t,e){t();let n=setInterval(t,1e3);document.addEventListener("visibilitychange",(function(){document.hidden?clearInterval(n):n=setInterval(t,1e3)}))}((()=>function(t){(async function(t){const e=await a("me/player/currently-playing","GET",t);if(!e)return null;const n=await a("audio-features","GET",t,{ids:e.item.id});return{id:e.item.id,name:e.item.name,artists:e.item.artists.map((t=>t.name)),tempo:n.audio_features[0].tempo}})(t).then(i).catch((t=>{if("401"!=t.message)throw t;o()}))}(t)))})),document.getElementById("sign-out").onclick=function(){localStorage.clear(),location.reload()}})();
//# sourceMappingURL=bundle.a66d9be84f9b5256ba67.js.map