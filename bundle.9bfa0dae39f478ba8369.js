(()=>{"use strict";function t(){let t=function(t){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="";for(let t=0;t<16;t++)n+=e.charAt(Math.floor(Math.random()*e.length));return n}();const e=new URLSearchParams;e.append("client_id","41c67233bcd94457a9d0cecaf0e36aae"),e.append("scope","user-read-currently-playing"),e.append("show_dialog","true"),e.append("redirect_uri","https://barkm.github.io/spotify-bpm/"),e.append("response_type","token"),e.append("state",t),localStorage.setItem("authorization_state",t);const n="https://accounts.spotify.com/authorize?"+e.toString();window.open(n,"_self")}async function e(t,e,n,o=null){let a="https://api.spotify.com/v1/"+t;if(o){const t=new URLSearchParams;for(const[e,n]of Object.entries(o))t.append(e,n);a+="?"+t.toString()}const i=await fetch(a,{method:e,headers:{Authorization:"Bearer "+n,"Content-Type":"application/json",Accept:"application/json"}});if(401==i.status)throw Error("401");return 204==i.status?null:i.json()}function n(t){if(!t)return document.getElementById("tempo-value").innerHTML="",document.getElementById("tempo-unit").innerHTML="",document.getElementById("song").innerHTML="No track is playing",void(document.getElementById("artists").innerHTML="");document.getElementById("tempo-value").innerHTML=Math.floor(t.tempo).toString(),document.getElementById("tempo-unit").innerHTML="BPM",document.getElementById("song").innerHTML=t.name,document.getElementById("artists").innerHTML=t.artists.join(", ")}!function(){const o=function(){const t=new URLSearchParams(window.location.hash.slice(1)),e=Object.fromEntries(t.entries());if(e.state==localStorage.getItem("authorization_state"))return e.access_token}();o?function(t,e){let n=setInterval(t,1e3);document.addEventListener("visibilitychange",(function(){document.hidden?clearInterval(n):n=setInterval(t,1e3)}))}((()=>function(o){(async function(t){const n=await e("me/player/currently-playing","GET",t);if(!n)return null;const o=await e("audio-features","GET",t,{ids:n.item.id});return{id:n.item.id,name:n.item.name,artists:n.item.artists.map((t=>t.name)),tempo:o.audio_features[0].tempo}})(o).then(n).catch((e=>{if("401"!=e.message)throw e;t()}))}(o))):t()}()})();
//# sourceMappingURL=bundle.9bfa0dae39f478ba8369.js.map